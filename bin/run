#!/bin/bash

run_dir="$(realpath "$0" | xargs dirname | xargs dirname)"
help="View help with 'run help'."

if [[ $# -lt 1 ]]
then
    printf "No arguments provided. %s\n" "$help"
    exit 1
fi

if [[ "$1" == *.* ]]
then
    target="$1"
    rule="${target##*.}"
else
    rule="$1"
    if [[ $# -ge 2 ]]
    then
        target="$2"
    else
        target=""
    fi
fi

if [[ "" != "$target" ]]
then
    target="$(realpath "$target")"
    
    if [[ ! -f "$target" && ! -d "$target" ]]
    then
        printf "Target '%s' not found.\n" "$target"
        exit 1
    fi
fi
   
if [[ ! -f "$run_dir/rule/$rule" ]]
then
    printf "Rule '%s' not found.\n" "$rule"
    exit 1
fi

"$run_dir/util/run_rule" "$run_dir" "$rule" "${target%.*}" <&0 || exit $?
