#!/bin/bash

RUN_DIR="$(realpath "$0" | xargs dirname | xargs dirname)"
HELP="View help with 'run help'."

if [[ $# -lt 1 ]]
then
    echo "No arguments provided. $HELP"
    exit 1
fi

if [[ "$1" == *.* ]]
then
    FILE="$1"
    RULE="${FILE##*.}"
else
    RULE="$1"
    if [[ $# -ge 2 ]]
    then
        FILE="$2"
    else
        FILE=""
    fi
fi

if [[ "" != "$FILE" ]]
then
    FILE="$(realpath "$FILE")"
    
    if [[ ! -f "$FILE" ]]
    then
        echo "File '$FILE' not found."
        exit 1
    fi
fi
   
if [[ ! -f "$RUN_DIR/rule/$RULE" ]]
then
    echo "Rule '$RULE' not found."
    exit 1
fi

"$RUN_DIR/util/run_rule" "$RUN_DIR" "$RULE" "${FILE%.*}" <&0 || exit $?
